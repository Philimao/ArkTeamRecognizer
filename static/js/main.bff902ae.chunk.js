(this["webpackJsonpark-team-recog"]=this["webpackJsonpark-team-recog"]||[]).push([[0],{65:function(e,t,a){"use strict";a.r(t);var r=a(2),n=a.n(r),c=a(27),s=a.n(c),l=a(4),i=a.n(l),o=a(12),u=a(18),h=a(3),b=a(1),j=a(6),d=a(28),m=(a(63),a(0));function g(){var e=Object(r.useState)(),t=Object(h.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)(!1),s=Object(h.a)(c,2),l=s[0],g=s[1],f=Object(r.useState)(.6),v=Object(h.a)(f,2),O=v[0],p=v[1],x=Object(r.useState)(1),w=Object(h.a)(x,2),y=w[0],N=w[1],S=Object(r.useState)(),k=Object(h.a)(S,2),C=k[0],A=k[1],q=Object(r.useState)(1.5),I=Object(h.a)(q,2),W=I[0],M=I[1],R=Object(r.useState)(),E=Object(h.a)(R,2),F=E[0],z=E[1],D=Object(r.useState)(),T=Object(h.a)(D,2),H=T[0],L=T[1],J=Object(r.useState)(!1),P=Object(h.a)(J,2),U=P[0],_=P[1],B=Object(r.useState)(),G=Object(h.a)(B,2),K=G[0],Q=G[1],V=Object(r.useState)(""),X=Object(h.a)(V,2),Y=X[0],Z=X[1],$=Object(r.useState)(0),ee=Object(h.a)($,2),te=ee[0],ae=ee[1];function re(){return(re=Object(u.a)(i.a.mark((function e(){var t,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!K){e.next=2;break}return e.abrupt("return");case 2:return _(!0),t=document.querySelectorAll("canvas")[1],a=Object(d.createWorker)({logger:function(e){ae(parseFloat(e.progress)),Z(e.status),console.log(e)}}),e.next=7,a.load();case 7:return e.next=9,a.loadLanguage("chi_sim");case 9:return e.next=11,a.initialize("chi_sim");case 11:return e.next=13,a.recognize(t);case 13:r=e.sent,console.log(r),Q(r.data.text);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){return(ne=Object(u.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("None"!==t){e.next=2;break}return e.abrupt("return");case 2:(a=new Image).onload=function(){var e=document.querySelectorAll("canvas")[2];e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0),Q(void 0),n(a)},a.src="/images/team"+t+".jpg";case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.useEffect)((function(){var e=document.querySelectorAll("canvas");e[0].height=0,e[1].height=0}),[]),Object(r.useEffect)((function(){if(l){console.clear(),document.querySelectorAll("canvas")[2].getContext("2d").drawImage(a,0,0);var e=document.querySelectorAll("canvas")[2],t=new b.c("uint8",[e.height,e.width,4]);b.f(e,t);var r=b.j(t);r=b.g(r,2,"nearest"),r=b.h(r,3,3),r=b.l(r),r=b.d(r,O,y),r=b.k(r,2,2,2);var n=b.n(r),c=new b.b;c.init(r),c.runOp(r,0,n);for(var s=Math.max(e.height,e.width),i=[],u=0;u<n.size/4;u+=1){var h=Math.floor(u/n.shape[1]),d=u-h*n.shape[1],m=n.get(h,d,0),g=n.get(h,d,1),f=n.get(h,d,2);m>0&&i.push([m,g,f])}i=i.sort((function(e,t){return t[0]-e[0]})).slice(0,400);for(var v=[],p=[],x=0;x<i.length;x+=1){var w=new b.a;w.fromParallelCoords(2*i[x][1],2*i[x][2],e.width,e.height,s,s/2),Math.abs(w.angle-90)>89?v.push(w):Math.abs(w.angle-90)<1&&p.push(w)}v.sort((function(t,a){return Math.abs((t.y1+t.y2)/2-e.height/2)-Math.abs((a.y1+a.y2)/2-e.height/2)}));var N=v[0],S=Math.abs(N.y1+N.y2-e.height)+W;A(S),console.log("gapH height",S);for(var k,C=new b.a(0,e.height/2,e.width,e.height/2),q=p.map((function(e){return b.a.Intersection(e,C)[0]})),I=2;I<q.length;I++){var M,R=Object(j.ckmeans)(q,I),E=0,F=Object(o.a)(R);try{for(F.s();!(M=F.n()).done;){var D=M.value;E+=Object(j.variance)(D)}}catch(re){F.e(re)}finally{F.f()}if(E<20){k=R;break}}for(var T,H=k.map((function(e){return Object(j.mean)(e)})).sort((function(e,t){return e-t})),J=[],P=0;P<H.length-1;P++)for(var U=P+1;U<H.length;U++)J.push(H[U]-H[P]);for(var _=2;_<J.length;_++){var B,G=Object(j.ckmeans)(J,_),K=0,Q=Object(o.a)(G);try{for(Q.s();!(B=Q.n()).done;){var V=B.value;K+=Object(j.variance)(V)}}catch(re){Q.e(re)}finally{Q.f()}if(K<20){T=G;break}}var X=T.sort((function(e,t){return t.length-e.length})).map((function(e){return Object(j.mean)(e)}));console.log("candidate gapW",X);var Y,Z,$={gapW:2*S,charW:8*S};console.log($);var ee,te=Object(o.a)(X);try{for(te.s();!(ee=te.n()).done;){var ae=ee.value;if(!Y&&Object(j.variance)([ae,$.gapW])<$.gapW)Y=ae;else if(!Z&&Object(j.variance)([ae,$.charW])<$.charW)Z=ae;else if(Y&&Z)break}}catch(re){te.e(re)}finally{te.f()}z(Y),L(Z),console.log("gapW width",Y,"char width",Z)}}),[l,a,O,y,W]),Object(r.useEffect)((function(){if(F&&C&&H){var e=document.querySelectorAll("canvas")[2],t=document.querySelectorAll("canvas")[1],a=t.getContext("2d"),r=e.width/2-3.5*H-3*F,n=2.7*C,c=e.height/2-n;t.height=2*n,t.width=6*H;for(var s=r,l=c,i=0;i<12;i++){var o=b.i(e,s,l,H,n);s+=H+F,5===i&&(s=r,l+=2.336*H),i<6?a.putImageData(o,i*H,0):a.putImageData(o,(i-6)*H,n)}var u=new b.c("uint8",[t.height,t.width,4]);u.data.fill(255);var h=new b.c("uint8",[t.height,t.width,4]);b.f(t,h);var j=b.m(u,h),d=b.n(j),m=new b.b;m.init(j),m.runOp(j,0,d),b.e(t,d)}}),[F,C,H]),Object(r.useEffect)((function(){if(F&&C&&H){var e=document.querySelectorAll("canvas")[2],t=document.querySelectorAll("canvas")[0],a=t.getContext("2d"),r=H/3.4516,n=e.width/2-2.865*H-3*F,c=e.height/2-H/1.671;t.height=r,t.width=12*r;for(var s=n,l=c,i=0;i<12;i++){var o=b.i(e,s,l,r,r);s+=H+F,5===i&&(s=n,l+=2.336*H),a.putImageData(o,i*r,0)}}}),[F,C,H]),Object(m.jsxs)("div",{className:"container py-4",children:[Object(m.jsx)("h2",{className:"mb-4",children:"Arknights Team Recognizer"}),Object(m.jsxs)("div",{className:"mb-4",children:[Object(m.jsx)("h5",{className:"mb-2",children:"Step 1: choose an image"}),Object(m.jsx)("label",{className:"form-label",children:"Upload your own team screenshot"}),Object(m.jsx)("input",{className:"form-control mb-3",type:"file",accept:"image/*",onChange:function(e){var t=new FileReader;e.target.files[0]&&(t.readAsDataURL(e.target.files[0]),t.onload=function(e){var t=new Image;t.onload=function(){var e=document.querySelectorAll("canvas")[2];e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),Q(void 0),n(t)},t.src=e.target.result.toString()})}}),Object(m.jsxs)("div",{className:"mb-3",children:[Object(m.jsx)("label",{className:"form-label",children:"Or use our provided sample images"}),Object(m.jsxs)("select",{className:"form-select",onChange:function(e){return function(e){return ne.apply(this,arguments)}(e.target.value)},children:[Object(m.jsx)("option",{value:"None",children:"None"}),new Array(7).fill(0).map((function(e,t){return Object(m.jsx)("option",{value:t,children:"Team "+t},t)}))]})]}),Object(m.jsx)("button",{className:"btn btn-outline-primary me-3",onClick:function(){return g(!0)},children:"Split"})]}),l?Object(m.jsxs)("div",{className:"mb-4",children:[Object(m.jsx)("h5",{children:"Step 2: adjust the params to render a correct crop of op names then start OCR"}),Object(m.jsxs)("div",{className:"d-flex",children:[Object(m.jsxs)("label",{className:"form-label me-3",children:["Canny Low Threshold",Object(m.jsx)("input",{className:"form-control",type:"number",min:0,max:1,step:.05,value:O,onChange:function(e){return p(parseFloat(e.target.value))}})]}),Object(m.jsxs)("label",{className:"form-label me-3",children:["Canny High Threshold",Object(m.jsx)("input",{className:"form-control",type:"number",min:0,max:1,step:.05,value:y,onChange:function(e){return N(parseFloat(e.target.value))}})]}),Object(m.jsxs)("label",{className:"form-label me-3",children:["Gap H offset",Object(m.jsx)("input",{className:"form-control",type:"number",min:-5,max:5,step:.5,value:W,onChange:function(e){return M(parseFloat(e.target.value))}})]})]}),Object(m.jsx)("button",{className:"btn btn-outline-primary me-3",onClick:function(){return re.apply(this,arguments)},children:"OCR"})]}):null,l&&U?Object(m.jsxs)("div",{className:"mb-4",children:[Object(m.jsx)("div",{className:"form-label mb-3",children:"Status: "+Y}),Object(m.jsx)("label",{className:"form-label me-3s",children:"Progress"}),Object(m.jsx)("div",{className:"progress mb-3",children:Object(m.jsx)("div",{className:"progress-bar progress-bar-striped progress-bar-animated",role:"progressbar",style:{width:100*te+"%"},children:100*te+"%"})}),K?Object(m.jsxs)("div",{children:["Result: ",Object(m.jsx)("strong",{children:K})]}):null]}):null,Object(m.jsx)("div",{children:Object(m.jsx)("canvas",{})}),Object(m.jsx)("div",{children:Object(m.jsx)("canvas",{})}),Object(m.jsx)("div",{children:Object(m.jsx)("canvas",{})})]})}function f(){return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(g,{})})}s.a.render(Object(m.jsx)(n.a.StrictMode,{children:Object(m.jsx)(f,{})}),document.getElementById("root"))}},[[65,1,2]]]);
//# sourceMappingURL=main.bff902ae.chunk.js.map